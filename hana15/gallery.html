---
layout: default
title: 神納花の15会
description: こちらは 神納花の15会 のページです。
---
<link rel="preconnect" href="https://script.google.com">
<style>
  .gallery{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden;box-shadow:0 4px 10px rgba(0,0,0,.05)}
  .card img{width:100%;height:auto;display:block;aspect-ratio:4/3;object-fit:cover}
  .belowfold{content-visibility:auto;contain-intrinsic-size:1px 400px;}
  .modal-link a#enlargeLink{ display:none !important; } /* 既存の拡大リンクは使わない */
  @media (min-width:1024px){.gallery{grid-template-columns:repeat(3,1fr)}}
</style>

<main>
  <h1>神納花の15会 活動の様子</h1>
  <section id="gallery" class="gallery"></section>
  <p style="margin-top:16px"><a href="{{ '/' | relative_url }}">← トップページに戻る</a></p>
</main>

<script>
  // ★あなたのWebアプリURLに置換
  const GAS = 'https://script.google.com/macros/s/AKfycbzSrIs7r7mf82Amk2YiRu06yLaKUyxB4S4UwjEUaWmub5uvP4daFA1DW6l41nUH48Q8/exec';
  // ★viewer.html（“大”表示ページ）
  const VIEWER = "{{ '/hana15/viewer.html' | relative_url }}"; // ← Jekyll でサイト内URLに

  // 表示したいキー（DriveのIDは公開しない）
  const KEYS = [
    "081","082","083","084","085","086","087","088","089","090",
    "091","092","093","094","095","096","097","098",
    "20140406_1","20140406_2","20140406_3","20140406_4","20140406_5",
    "20140406_6","20140406_7","20140406_8","20140406_9",
    "20140518_108","20140518_109","20140518_110","20140518_111","20140518_112",
    "20140518_113","20140518_114","20140518_115","20140518_116","20140518_117",
    "20140518_118","20140518_119","20140518_120","20140518_121","20140518_122",
    "20140518_123","20140518_124","20140518_125","20140518_126","20140518_127",
    "20140518_128","20140518_129","20140518_130","20140518_131","20140518_132",
    "20140518_133","20140518_134","20140518_135","20140518_136","20140518_137",
    "20140518_138","20140518_139","20140518_140","20140518_142",
    "20140724_18","20140724_19","20140724_20","20140724_21","20140724_22",
    "20140724_23","20140724_30","20140724_31","20140724_32","20140724_33",
    "20140724_34","20140724_35","20140724_36","20140724_37","20140724_38",
    "20140724_39","20140724_40","20140724_41","20140724_42","20140724_43",
    "20140724_44","20140724_46",
    "20140821_1","20140821_2","20140821_3","20140821_4","20140821_5",
    "20140821_6","20140821_7","20140821_9","20140821_10","20140821_11",
    "20140821_12","20140821_14","20140821_15","20140821_16","20140821_17",
    "20140821_18","20140821_19","20140821_20","20140821_21","20140821_22",
    "20140821_23","20140821_24","20140821_25",
    "20140911_32","20140911_33","20140911_34","20140911_35","20140911_36","20140911_37"
  ];

  const box = document.getElementById('gallery');

  // 1) 先に枠だけ並べる（a の href は最初から viewer.html?k=… にする）
  box.innerHTML = KEYS.map((k,i)=>`
    <figure class="card ${i>9?'belowfold':''}">
      <a class="viewer"
         data-k="${k}"
         href="${VIEWER}?k=${encodeURIComponent(k)}"
         target="_blank" rel="noopener">
        <img id="img-${k}" alt="${k}" loading="lazy" decoding="async" ${i<6?'fetchpriority="high"':''}>
      </a>
      <figcaption>${k}</figcaption>
    </figure>
  `).join('');

  // 2) サムネイル用 data:URL を取得してセット（“中表示”は blob を使う）
  (async () => {
    for (const k of KEYS) {
      try {
        const r = await fetch(`${GAS}?k=${encodeURIComponent(k)}`);
        const j = await r.json();
        const el = document.getElementById(`img-${k}`);
        const a  = el?.closest('a');
        if (j && j.ok && el && a) {
          // サムネ（小表示）：data:URL
          el.src = j.dataUrl;
          // モーダル用（中表示）：blob:URL を仕込む（リンクの href は触らない！）
          const blob = await (await fetch(j.dataUrl)).blob();
          a.dataset.url = URL.createObjectURL(blob); // “中”はこれを使う
        } else if (el) {
          el.alt = (j && j.msg) || 'load error';
        }
      } catch (e) {
        console.error(k, e);
      }
    }
  })();

  // 画像を順次ロード（サムネ <img> は dataURL／モーダル用には blob URL も用意）
  (async () => {
    for (const k of KEYS) {
      try {
        const r = await fetch(`${GAS}?k=${encodeURIComponent(k)}`);
        const j = await r.json();
        const el = document.getElementById(`img-${k}`);
        if (j && j.ok) {
          el.src = j.dataUrl;

          // モーダル用の blob URL を作って <a data-url> に覚えさせる
          const a = el.closest('a');
          if (a) {
            const blob = await (await fetch(j.dataUrl)).blob();
            const objUrl = URL.createObjectURL(blob);
            a.dataset.url = objUrl; // ← モーダルはこれを使う
          }
        } else {
          el.alt = (j && j.msg) || 'load error';
        }
      } catch (e) {
        console.error(k, e);
      }
    }
  })();

</script>
  (function () {
    const modal = document.getElementById('modal');
    const img   = document.getElementById('modalImage');

    // ① 自前の「さらに拡大表示」ボタンを挿入（viewer 用）
    const holder = document.querySelector('.modal-link') || modal;
    const myBtn  = document.createElement('a');
    myBtn.id = 'galleryEnlarge';
    myBtn.textContent = '▶ さらに拡大表示';
    myBtn.target = '_blank';
    myBtn.rel = 'noopener';
    myBtn.style.display = 'inline-block';
    myBtn.style.margin  = '8px 0 0';
    holder.appendChild(myBtn);

    let zoomLevel = 1;

    // ② ギャラリー内カードクリック → モーダルを“中”で開く（blob）、拡大ボタンは viewer.html に
    document.addEventListener('click', (ev) => {
      const a = ev.target.closest('a.viewer');
      if (!a) return;

      ev.preventDefault();                 // ここでは新規タブを開かない（モーダルを開く）
      const blobUrl = a.dataset.url;
      if (blobUrl) img.src = blobUrl;

      // viewer.html?k=… を“普通のリンク”としてセット（ポップアップ扱いにならない）
      myBtn.href = a.href;

      zoomLevel = 1;
      applyZoom();
      modal.classList.add('show');
    });

    // ③ 閉じる
    window.closeModal = function () {
      modal.classList.remove('show');
      img.src = '';
    };

    // ④ 3段階ズーム
    img.addEventListener('click', () => {
      zoomLevel = (zoomLevel + 1) % 3;
      applyZoom();
    });
    function applyZoom() {
      img.style.objectFit = 'contain';
      img.style.width     = '100%';
      img.style.height    = 'auto';
      img.style.maxHeight = (zoomLevel === 2) ? 'none' : '90vh';
      img.style.maxWidth  = (zoomLevel === 0) ? '720px'
                          : (zoomLevel === 1) ? '1200px'
                          : 'none';
      img.style.display   = 'block';
    }
  })();
</script>

<script>
// ---- 強制上書きパッチ（about:blank#blocked 対策） ----
(function(){
  // 既存リスナーを全部剥がす
  const old = document.getElementById('enlargeLink');
  if (!old) return;
  const clone = old.cloneNode(true);
  old.replaceWith(clone); // ← 既存の click リスナーを全部除去

  // href を viewer.html?k=.. に毎回セット（モーダル表示時に doc側でセットしているなら不要）
  // 念のため、モーダル表示処理がセット済みの data-key を見て再セットする保険を入れます
  function ensureHrefFromModal() {
    const imgA = document.querySelector('.modal .card a, a[data-key]'); // 適当に拾う
    const key  = (imgA && imgA.dataset && imgA.dataset.key) || null;
    if (key) {
      clone.href   = "{{ '/hana15/viewer.html' | relative_url }}?k=" + encodeURIComponent(key);
      clone.target = "_blank";
      clone.rel    = "noopener";
    }
  }

  // クリック時は “通常のリンク遷移” をさせる（JS で書き込みしない）
  clone.addEventListener('click', function(ev){
    // 他のスクリプトが preventDefault しても勝つように、直前に href を保証
    ensureHrefFromModal();
    // ここでは preventDefault しない → 通常の a[target=_blank] ナビに任せる
    // もし他のスクリプトが stopPropagation 済みでも、ここは直接の要素なので効きます
  }, {capture:true}); // capture で最優先
})();
</script>

</main>